<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <script src="https://st.max.ru/js/max-web-app.js"></script>
  <title>MAX WebApp Core</title>
</head>
<body>
<script>
(async () => {
  const log = (...args) => console.log('[MAX]', ...args);

  if (!window.WebApp) {
    console.warn('‚ö†Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç–µ —á–µ—Ä–µ–∑ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É MAX');
    return;
  }

  // 1. Init
  const initData = window.WebApp.initData;
  const data = window.WebApp.initDataUnsafe;
  log('initData:', initData);
  log('User:', data?.user);
  window.WebApp.ready();

  // 2. Events
  window.WebApp.onEvent(event => {
    if (event.type === 'contact_received') {
      log('üìû –ö–æ–Ω—Ç–∞–∫—Ç –ø–æ–ª—É—á–µ–Ω:', event.contact.phone_number);
    } else if (event.status === 'downloading') {
      log('‚úÖ –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –Ω–∞—á–∞–ª–æ—Å—å');
    } else if (event.status === 'cancelled') {
      log('‚ö†Ô∏è –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ');
    } else if (event.error) {
      log('‚ùå –û—à–∏–±–∫–∞:', event.error.code);
    } else {
      log('–°–æ–±—ã—Ç–∏–µ:', event);
    }
  });

  // 3. –ü—Ä–∏–º–µ—Ä—ã –≤—ã–∑–æ–≤–æ–≤:

  // –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
  const fileUrl = 'https://example.com/sample.pdf';
  const fileName = '–ü—Ä–∏–º–µ—Ä.pdf';
  const requestId = 'req-' + Date.now();

  try {
    window.WebApp.downloadFile({
      requestId,
      url: fileUrl,
      file_name: fileName
    });
    log(`‚è¨ –ó–∞–ø—Ä–æ—Å –Ω–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ: ${fileName}`);
  } catch (e) {
    log('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏:', e.message);
  }

  // –û—Ç–∫—Ä—ã—Ç–∏–µ –≤–Ω–µ—à–Ω–µ–π —Å—Å—ã–ª–∫–∏
  try {
    window.WebApp.openLink('https://max.ru');
    log('üåê –°—Å—ã–ª–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∞');
  } catch (e) {
    log('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è —Å—Å—ã–ª–∫–∏:', e.message);
  }

  // –ó–∞–ø—Ä–æ—Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞
  try {
    window.WebApp.requestContact();
    log('üì≤ –ó–∞–ø—Ä–æ—Å –∫–æ–Ω—Ç–∞–∫—Ç–∞');
  } catch (e) {
    log('–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫–æ–Ω—Ç–∞–∫—Ç–∞:', e.message);
  }

  // –í–∫–ª—é—á–µ–Ω–∏–µ/–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
  window.WebApp.enableClosingConfirmation();
  log('‚ö†Ô∏è –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤—ã—Ö–æ–¥–∞ –≤–∫–ª—é—á–µ–Ω–æ');

  // –ó–∞–∫—Ä—ã—Ç–∏–µ (—á–µ—Ä–µ–∑ 15 —Å–µ–∫—É–Ω–¥)
  setTimeout(() => {
    log('‚ùå –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è');
    window.WebApp.close();
  }, 15000);
})();
</script>
</body>
</html>
