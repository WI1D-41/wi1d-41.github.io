<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF‚Äë8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>MAX WebApp Full</title>
  <script src="https://st.max.ru/js/max-web-app.js"></script>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    header, footer {
      background: #0078D4;
      color: white;
      text-align: center;
      padding: 12px;
    }
    main {
      flex: 1;
      padding: 16px;
    }
    .btn {
      padding: 10px 16px;
      margin: 4px 0;
      width: 100%;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 1rem;
    }
    .btn-primary {
      background: #0078D4;
      color: white;
    }
    .btn-secondary {
      background: #e0e0e0;
    }
    .info {
      margin: 12px 0;
      padding: 10px;
      background: #f5f5f5;
      border-radius: 6px;
      white-space: pre-wrap;
    }
    input {
      padding: 8px;
      margin-bottom: 8px;
      width: 100%;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
  </style>
</head>
<body>

<header><h1>MAX WebApp</h1></header>

<main>
  <div class="info" id="status">‚è≥ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</div>

  <input type="url" id="urlInput" placeholder="https://example.com/file.pdf">
  <input type="text" id="fileNameInput" placeholder="–ò–º—è —Ñ–∞–π–ª–∞ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è">

  <button class="btn btn-primary" onclick="downloadFile()">üì• –°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª</button>
  <button class="btn btn-secondary" onclick="requestContact()">üì± –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω</button>
  <button class="btn btn-secondary" onclick="openLink()">üåê –û—Ç–∫—Ä—ã—Ç—å max.ru</button>
  <button class="btn btn-secondary" onclick="enableConfirm()">‚úÖ –í–∫–ª—é—á–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–∏—è</button>
  <button class="btn btn-secondary" onclick="disableConfirm()">üö´ –í—ã–∫–ª—é—á–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</button>
  <button class="btn btn-primary" onclick="closeApp()">‚ùå –ó–∞–∫—Ä—ã—Ç—å</button>
</main>

<footer><small>¬© MAX WebApp</small></footer>

<script>
  const status = document.getElementById('status');

  function log(msg) {
    status.textContent = msg;
    console.log('[LOG]', msg);
  }

  try {
    if (!window.WebApp) {
      log('‚ùå –≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –≤–Ω—É—Ç—Ä–∏ MAX');
      throw new Error('WebApp bridge is not –¥–æ—Å—Ç—É–ø–µ–Ω');
    }

    const user = window.WebApp.initDataUnsafe?.user;
    log(user ? `üëã –ü—Ä–∏–≤–µ—Ç, ${user.first_name}!` : 'üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!');

    window.WebApp.ready();

    window.WebApp.onEvent(e => {
      if (e.type === 'contact_received') {
        log(`üìû –¢–µ–ª–µ—Ñ–æ–Ω: ${e.contact.phone_number}`);
      } else if (e.status === 'downloading') {
        log(`‚úÖ –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –Ω–∞—á–∞–ª–æ—Å—å`);
      } else if (e.status === 'cancelled') {
        log(`‚ö†Ô∏è –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ`);
      } else if (e.error) {
        log(`‚ùå –û—à–∏–±–∫–∞: ${e.error.code}`);
      }
    });

  } catch (e) {
    log('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ' + e.message);
  }

  function closeApp() {
    if (window.WebApp?.close) {
      window.WebApp.close();
    }
  }

  function requestContact() {
    try {
      window.WebApp.requestContact();
    } catch (e) {
      log('requestContact –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
    }
  }

  function openLink() {
    try {
      window.WebApp.openLink('https://max.ru');
    } catch (e) {
      log('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Å—ã–ª–∫–∏');
    }
  }

  function enableConfirm() {
    window.WebApp.enableClosingConfirmation();
    log('‚ö†Ô∏è –í–∫–ª—é—á–µ–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–∏—è');
  }

  function disableConfirm() {
    window.WebApp.disableClosingConfirmation();
    log('üëå –í—ã–∫–ª—é—á–µ–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ');
  }

  function downloadFile() {
    const url = document.getElementById('urlInput').value.trim();
    const fileName = document.getElementById('fileNameInput').value.trim();
    const requestId = 'req-' + Date.now();

    if (!/^https:\/\//.test(url)) {
      log('‚ùå URL –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å https://');
      return;
    }

    if (!fileName) {
      log('‚ùå –£–∫–∞–∂–∏—Ç–µ –∏–º—è —Ñ–∞–π–ª–∞');
      return;
    }

    try {
      window.WebApp.downloadFile({
        requestId,
        url,
        file_name: fileName
      });
      log(`üì• –ó–∞–ø—Ä–æ—Å –Ω–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞: ${fileName}`);
    } catch (e) {
      log('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ downloadFile: ' + e.message);
    }
  }
</script>

</body>
</html>
