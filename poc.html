<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF‚Äë8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>MAX WebApp with Download</title>
  <script src="https://st.max.ru/js/max-web-app.js"></script>
  <style>
    body { margin:0; font-family:sans-serif; display:flex; flex-direction:column; min-height:100vh; }
    header, footer { background:#0078D4; color:#fff; text-align:center; padding:12px; }
    main { flex:1; padding:16px; }
    .btn { padding:10px 16px; margin:4px; border:none; border-radius:4px; cursor:pointer; }
    .btn-primary { background:#0078D4; color:#fff; }
    .btn-secondary { background:#e0e0e0; }
    .info { margin:8px 0; padding:8px; background:#f0f0f0; border-radius:4px; white-space:pre-wrap; }
    .input-row { display:flex; flex-direction:column; margin:8px 0; }
    label { margin-bottom:4px; font-weight:bold; }
    input { padding:8px; border:1px solid #ccc; border-radius:4px; }
  </style>
</head>
<body>

  <header><h1>MAX WebApp Demo</h1></header>

  <main>
    <div class="info" id="userInfo">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>

    <div class="input-row">
      <label for="urlInput">–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–∞–π–ª (https):</label>
      <input id="urlInput" type="url" placeholder="https://example.com/file.pdf" required>
    </div>

    <div class="input-row">
      <label for="fileNameInput">–ò–º—è —Ñ–∞–π–ª–∞:</label>
      <input id="fileNameInput" type="text" placeholder="file.pdf" required>
    </div>

    <button class="btn btn-primary" id="downloadBtn">üì• –°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª</button>

    <hr>

    <button class="btn btn-secondary" id="closeBtn">–ó–∞–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</button>
    <button class="btn btn-secondary" id="contactBtn">–ü–æ–ª—É—á–∏—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω</button>
    <button class="btn btn-secondary" id="linkBtn">–û—Ç–∫—Ä—ã—Ç—å —Å—Å—ã–ª–∫—É</button>
    <button class="btn btn-secondary" id="confirmBtn">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏</button>
    <button class="btn btn-secondary" id="disableConfirmBtn">–û—Ç–∫–ª—é—á–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</button>

    <div class="info" id="logArea">–ì–æ—Ç–æ–≤–æ.</div>
  </main>

  <footer><small>¬© MAX WebApp 2025</small></footer>

  <script>
    const infoEl = document.getElementById('userInfo');
    const logEl = document.getElementById('logArea');

    const initData = window.WebApp.initData;
    const data = window.WebApp.initDataUnsafe;

    infoEl.textContent = JSON.stringify(data, null, 2);
    window.WebApp.ready();

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫
    document.getElementById('closeBtn').onclick = () => window.WebApp.close();
    document.getElementById('contactBtn').onclick = () => window.WebApp.requestContact();
    document.getElementById('linkBtn').onclick = () => window.WebApp.openLink('https://max.ru');
    document.getElementById('confirmBtn').onclick = () => window.WebApp.enableClosingConfirmation();
    document.getElementById('disableConfirmBtn').onclick = () => window.WebApp.disableClosingConfirmation();

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–∞
    window.WebApp.onEvent(e => {
      if (e.type === 'contact_received') {
        log(`üì± –¢–µ–ª–µ—Ñ–æ–Ω: ${e.contact.phone_number}`);
      }
    });

    // === DOWNLOAD FILE ===
    const downloadBtn = document.getElementById('downloadBtn');

    downloadBtn.onclick = () => {
      const url = document.getElementById('urlInput').value.trim();
      const fileName = document.getElementById('fileNameInput').value.trim();
      const requestId = 'req-' + Date.now();

      if (!/^https:\/\//.test(url) || !fileName) {
        log('‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã');
        return;
      }

      log(`‚è¨ –ó–∞–ø—Ä–æ—Å –Ω–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ: ${fileName}`);

      window.WebApp.downloadFile({ requestId, url, file_name: fileName });

      window.WebApp.onEvent(e => {
        if (e.requestId !== requestId) return;

        if (e.status === 'downloading') {
          log(`‚úÖ –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –Ω–∞—á–∞–ª–æ—Å—å: ${fileName}`);
        } else if (e.status === 'cancelled') {
          log(`‚ö†Ô∏è –ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º`);
        } else if (e.error) {
          log(`‚ùå –û—à–∏–±–∫–∞: ${e.error.code}`);
        }
      });
    };

    function log(msg) {
      logEl.textContent = msg;
    }
  </script>
</body>
</html>
